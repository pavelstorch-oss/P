<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Slepá mapa</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
body { margin:0; font-family:Arial; }
#map { height:90vh; }
#panel { padding:10px; background:#f2f2f2; }
</style>
</head>
<body>

<div id="panel">
  <b id="question">Načítám...</b>
  Skóre: <span id="score">0</span>
  <button onclick="newGame()">Nová hra</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>

let map = L.map('map').setView([50, 20], 4);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap'
}).addTo(map);

let score = 0;
let current = "";
let countryLayer;

function styleFeature() {
  return {
    color: "black",
    weight: 1,
    fillColor: "#ffffff",
    fillOpacity: 0.5
  };
}

function askQuestion(){
  countryLayer.eachLayer(l => countryLayer.resetStyle(l));

  let names = [];
  countryLayer.eachLayer(l => {
    names.push(l.feature.properties.ADMIN);
  });

  current = names[Math.floor(Math.random()*names.length)];
  document.getElementById("question").innerText =
      "Klikni na stát: " + current;
}

function newGame(){
  score = 0;
  document.getElementById("score").innerText = score;
  askQuestion();
}

fetch('countries.geojson')
  .then(res => res.json())
  .then(data => {

    countryLayer = L.geoJSON(data, {
      filter: feature =>
        ["Ukraine","Poland","Czechia",
         "Slovakia","Hungary","Romania",
         "Moldova","Belarus","Russia"].includes(feature.properties.ADMIN),

      style: styleFeature,

      onEachFeature: (feature, layer) => {
        layer.on('click', function(){
          if(feature.properties.ADMIN === current){
            layer.setStyle({ fillColor:"green" });
            score++;
            document.getElementById("score").innerText = score;
            setTimeout(askQuestion,800);
          } else {
            layer.setStyle({ fillColor:"red" });
          }
        });
      }
    }).addTo(map);

    askQuestion();
  });

</script>
</body>
</html>
